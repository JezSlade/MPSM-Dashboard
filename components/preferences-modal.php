<?php declare(strict_types=1);
// /components/preferences-modal.php
$cardsConfig=include __DIR__.'/../config/cards.php';
$visible=isset($_COOKIE['visible_cards'])?array_filter(array_map('trim',explode(',',$_COOKIE['visible_cards'])),'strlen'):[];
?>
<div id="preferences-modal" class="modal-backdrop hidden"><div class="modal-content max-w-2xl mx-auto"><h2 class="text-lg font-semibold mb-3 text-white">Select Cards to Display</h2><form id="preferences-form"><div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-4"><?php foreach($cardsConfig as$id=>$title){$checked=in_array($id,$visible)?'checked':'';?><label class="flex items-center space-x-2 text-white text-sm"><input type="checkbox" name="cards[]" value="<?= htmlspecialchars($id) ?>" <?= $checked ?> class="form-checkbox h-4 w-4 text-cyan-500"/><span><?= htmlspecialchars($title) ?></span></label><?php } ?></div><div class="flex justify-end space-x-2"><button type="button" id="select-all" class="px-3 py-1 text-sm rounded-md bg-gray-700 hover:bg-gray-600">Select All</button><button type="button" id="deselect-all" class="px-3 py-1 text-sm rounded-md bg-gray-700 hover:bg-gray-600">Deselect All</button><button type="button" id="save-preferences" class="px-3 py-1 text-sm rounded-md bg-cyan-500 hover:bg-cyan-400 text-black">Save</button><button type="button" id="cancel-preferences" class="px-3 py-1 text-sm rounded-md bg-red-600 hover:bg-red-500">Cancel</button></div></form></div></div><script>(function(){const m=document.getElementById('preferences-modal'),c=m.querySelectorAll('input[name="cards[]"]');document.getElementById('select-all').addEventListener('click',()=>c.forEach(cb=>cb.checked=true));document.getElementById('deselect-all').addEventListener('click',()=>c.forEach(cb=>cb.checked=false));document.getElementById('save-preferences').addEventListener('click',()=>{const s=Array.from(c).filter(cb=>cb.checked).map(cb=>cb.value);document.cookie=`visible_cards=${encodeURIComponent(s.join(','))};path=/;max-age=${60*60*24*365}`;togglePreferencesModal(false);location.reload();});document.getElementById('cancel-preferences').addEventListener('click',()=>togglePreferencesModal(false));})();</script>
