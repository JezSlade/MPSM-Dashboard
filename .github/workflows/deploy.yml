name: FTP Deploy - Final Lean

on:
  push:
    branches: ["main"]  # Trigger on pushes to the 'main' branch

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: ðŸ” Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ”¢ Generate Version File
        run: |
          echo "window.appVersion = \"0.0.0.${GITHUB_RUN_NUMBER}\";" > public/version.js
        env:
          GITHUB_RUN_NUMBER: ${{ github.run_number }}

      - name: ðŸš€ Deploy Website via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          server: ftp.resolutionsbydesign.us
          username: mpsm@mpsm.resolutionsbydesign.us
          password: Deploy123!
          protocol: ftp
          port: 21

          # NOTE: local-dir must end with a slash
          local-dir: ./public/

          # Remote directory to deploy into
          server-dir: /

          # Delete files on the server not present locally
          dangerous-clean-slate: true

          # Exclude files/folders
          exclude: |
            AllEndpoints.json
            src/**
            .github/**
          
          log-level: verbose

      - name: ðŸ“œ Deployment Completed Report
        run: |
          echo "### DEPLOYMENT SUMMARY ###"
          echo "- Version: 0.0.0.${GITHUB_RUN_NUMBER}"
          echo "- FTP Server: ftp.resolutionsbydesign.us"
          echo "- Server Directory: /"
          echo "- Local Directory: ./public/"
        env:
          GITHUB_RUN_NUMBER: ${{ github.run_number }}
