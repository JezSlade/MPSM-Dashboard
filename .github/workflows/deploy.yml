name: FTP Deploy - Exact Path Configuration

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Show complete file structure
        run: |
          echo "=== FILE STRUCTURE ==="
          find . -type d | sort
          echo "====================="

      - name: Bump version
        id: bump_version
        run: |
          set -euo pipefail
          [ -f version.txt ] || echo "0.0.0.0" > version.txt
          IFS='.' read -r a b c d < version.txt
          echo "$a.$b.$c.$((d + 1))" > version.txt
          echo "new_version=$(cat version.txt)" >> $GITHUB_OUTPUT

      - name: FTP Deploy
        uses: sebastianpopp/ftp-action@releases/v2
        with:
          host: "ftp.resolutionsbydesign.us"
          user: "mpsm@resolutionsbydesign.us"
          password: "MP$M_Nr0lr"
          localDir: "./"
          remoteDir: ""
          options: "--delete --transfer-all --verbose"

      - name: Deployment verification
        run: |
          echo "Deployment completed without errors"
          echo "Check your site at: https://resolutionsbydesign.us"
          echo "If files aren't visible:"
          echo "1. Verify exact case sensitivity of paths"
          echo "2. Check for .htaccess or permission issues"
          echo "3. Contact host about possible write delays"