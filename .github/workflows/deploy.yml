name: FTP Deploy - Final Lean

on:
  push:
    branches: ["main"] # Trigger on pushes to the 'main' branch

jobs:
  deploy:
    runs-on: ubuntu-latest # Run the job on a fresh Ubuntu environment
    timeout-minutes: 15 # Overall job timeout

    steps:
      - name: 🔍 Checkout Code
        uses: actions/checkout@v4 # Check out repository code

      - name: 🚀 Deploy Website via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5 # Use latest version
        with:
          server: ${{ secrets.FTP_SERVER }} # Use GitHub Secrets
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./ # Deploy from repository root
          server-dir: / # Deploy to FTP account's root
          protocol: ftp # Use 'ftps' if server requires explicit FTPS
          exclude: |
            .git/*
            .gitignore
            **/.git/**
            **/.gitignore
          log-level: verbose # Detailed transfer info
          delete: true # Delete server files not in local repository
          timeout-seconds: 120 # Timeout for deploy operation (2 minutes)

      - name: 📜 Deployment Completed Report
        run: |
          echo "### DEPLOYMENT SUMMARY ###" > report.md
          echo "- Deployment Method: SamKirkland/FTP-Deploy-Action" >> report.md
          echo "- Local repository root (./) deployed to: FTP account's home directory" >> report.md
          echo "  (Expected server path: /home/resolut7/public_html/mpsm.resolutionsbydesign.us/)" >> report.md
          echo "- Website URL: https://mpsm.resolutionsbydesign.us" >> report.md
          echo "" >> report.md
          echo "---" >> report.md
          echo "**Next Steps:**" >> report.md
          echo "1. **Verify Live Site:** Check https://mpsm.resolutionsbydesign.us in your browser." >> report.md
          echo "2. **Clear Cache:** If changes aren't visible, clear browser or server-side cache." >> report.md
          echo "3. **GreenGeeks Support:** If issues persist, contact GreenGeeks support with this workflow run link." >> report.md
          cat report.md