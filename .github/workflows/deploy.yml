name: FTP Deploy - Final Lean

on:
  push:
    branches: ["main"] 

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: 🔍 Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # needed if you ever tag

      - name: 🔢 Generate Version File
        run: |
          echo "window.appVersion = \"0.0.0.${GITHUB_RUN_NUMBER}\";" > public/version.js
        env:
          GITHUB_RUN_NUMBER: ${{ github.run_number }}

      - name: 🚀 Deploy Website via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./public
          server-directory: /
          protocol: ftp
          exclude: |
            ../.git/
            ../src/
            ../AllEndpoints.json
          log-level: verbose
          delete: true
          timeout: 120

      - name: 📜 Deployment Completed Report
        run: |
          echo "### DEPLOYMENT SUMMARY ###" > report.md
          echo "- Version: 0.0.0.${GITHUB_RUN_NUMBER}" >> report.md
          echo "- Method: FTP-Deploy-Action" >> report.md
          echo "- URL: https://mpsm.resolutionsbydesign.us" >> report.md
          cat report.md
        env:
          GITHUB_RUN_NUMBER: ${{ github.run_number }}
