name: FTP Deploy - No Nonsense

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # Hard timeout for entire job

    steps:
      - name: üõ†Ô∏è Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 1  # Faster checkout

      - name: üìú List Files to Upload
        run: |
          echo "=== FILES TO DEPLOY ==="
          ls -la
          echo "======================"

      - name: ‚ö° LFTP Deploy (Most Reliable)
        timeout-minutes: 3  # Step-specific timeout
        run: |
          sudo apt-get install -y lftp
          lftp -e "
            set ftp:ssl-allow no;
            set net:timeout 10;
            set net:max-retries 2;
            set ftp:passive-mode on;  # Try active mode if passive hangs
            open -u mpsm@resolutionsbydesign.us,'MP$M_Nr0lr' ftp.resolutionsbydesign.us;
            mirror --reverse \
                   --delete \
                   --verbose \
                   --exclude .git/ \
                   ./ /home/resolut7/public_html/resolutionsbydesign.us/;
            bye
          " || echo "LFTP exited with error (check logs above)"

      - name: ‚úÖ Final Verification
        run: |
          echo "If you see this, deployment command at least completed"
          echo "Check your website for updated files"
          echo "If files are missing:"
          echo "1. Verify path with your host"
          echo "2. Check FTP server logs"
          echo "3. Try manual FTP upload to compare"