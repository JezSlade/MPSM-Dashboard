name: FTP Deploy - Managed Hosting Edition

on:
  push:
    branches: ["main"]

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: 🛠️ Checkout Code
        uses: actions/checkout@v4

      - name: 🔍 Debug - Create Path Test Files
        run: |
          echo "=== TEST FILES ==="
          echo "This should appear in WEB ROOT" > web_root.txt
          echo "This should appear in PUBLIC_HTML" > public_html.txt
          echo "This tests SUBDIR" > subdir_test.txt
          mkdir -p public_html
          cp public_html.txt public_html/
          ls -la

      - name: 🚀 Smart FTP Deploy
        run: |
          sudo apt-get install -y lftp
          lftp -e "
            set ftp:ssl-allow no;
            set net:timeout 15;
            set ftp:passive-mode on;
            set xfer:log yes;
            
            open -u mpsm@resolutionsbydesign.us,'MP$M_Nr0lr' ftp.resolutionsbydesign.us;
            
            echo '=== SERVER PATH DEBUG ===';
            echo 'Current path:';
            pwd;
            echo 'Home directory:';
            ls -la ~;
            echo 'Public_html contents:';
            ls -la ~/public_html;
            
            echo '=== TRYING MULTIPLE LOCATIONS ===';
            put web_root.txt -o ./web_root.txt;
            put public_html.txt -o ./public_html/public_html.txt;
            put subdir_test.txt -o ./subdir_test.txt;
            
            echo '=== FINAL CHECK ===';
            find . -name '*.txt' -exec ls -la {} \;
            bye;
          "

      - name: 📜 Generate Location Report
        run: |
          echo "### WHERE TO CHECK YOUR FILES ###" > report.md
          echo "1. Primary test file locations:" >> report.md
          echo "   - https://resolutionsbydesign.us/web_root.txt" >> report.md
          echo "   - https://resolutionsbydesign.us/public_html.txt" >> report.md
          echo "   - https://resolutionsbydesign.us/subdir_test.txt" >> report.md
          echo "   - https://resolutionsbydesign.us/public_html/public_html.txt" >> report.md
          echo "" >> report.md
          echo "2. If none work, try these via FTP client:" >> report.md
          echo "   - /home/resolut7/web_root.txt" >> report.md
          echo "   - /home/resolut7/public_html/public_html.txt" >> report.md
          echo "   - /var/www/html/web_root.txt" >> report.md
          echo "" >> report.md
          echo "3. Required fix:" >> report.md
          echo "   - Compare which path actually works" >> report.md
          echo "   - Update remoteDir in workflow to match" >> report.md
          
          echo "=== DEPLOYMENT REPORT ==="
          cat report.md