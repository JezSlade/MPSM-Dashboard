<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        body {
            margin: 0;
            background-color: #2b2b2b;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .dashboard {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        .settings-menu {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #3a3a3a;
            padding: 15px;
            border-radius: 8px;
            box-shadow: inset 4px 4px 8px #2e2e2e, inset -4px -4px 8px #464646;
            z-index: 1000;
        }

        .settings-menu h2 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }

        .settings-menu label {
            display: block;
            margin: 5px 0;
            font-size: 14px;
        }

        .card {
            position: absolute;
            background-color: #3a3a3a;
            border-radius: 8px;
            box-shadow: 6px 6px 12px #252525, -6px -6px 12px #4f4f4f;
            cursor: default;
            user-select: none;
            transition: left 0.1s ease-out, top 0.1s ease-out;
        }

        .card-header {
            background-color: #454545;
            padding: 8px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .card-header span {
            font-size: 14px;
        }

        .card-content {
            padding: 15px;
            font-size: 14px;
        }

        .minimize, .close {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 16px;
            cursor: pointer;
            padding: 0 8px;
        }

        .minimize:hover, .close:hover {
            color: #ff6b6b;
        }

        #card1 { width: 200px; height: 150px; top: 50px; left: 50px; }
        #card2 { width: 300px; height: 200px; top: 80px; left: 300px; }
        #card3 { width: 250px; height: 180px; top: 300px; left: 100px; }
        #card4 { width: 150px; height: 100px; top: 100px; left: 600px; }
        #card5 { width: 350px; height: 250px; top: 250px; left: 400px; }
        #card6 { width: 220px; height: 160px; top: 400px; left: 50px; }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="settings-menu">
            <h2>Card Visibility</h2>
            <label><input type="checkbox" id="card1-toggle" checked> Card 1</label>
            <label><input type="checkbox" id="card2-toggle" checked> Card 2</label>
            <label><input type="checkbox" id="card3-toggle" checked> Card 3</label>
            <label><input type="checkbox" id="card4-toggle" checked> Card 4</label>
            <label><input type="checkbox" id="card5-toggle" checked> Card 5</label>
            <label><input type="checkbox" id="card6-toggle" checked> Card 6</label>
        </div>

        <div class="card" id="card1">
            <div class="card-header">
                <span>Card 1</span>
                <div>
                    <button class="minimize">-</button>
                    <button class="close">×</button>
                </div>
            </div>
            <div class="card-content">
                <p>Small card content goes here.</p>
                <button onclick="alert('Button clicked')">Click me</button>
            </div>
        </div>

        <div class="card" id="card2">
            <div class="card-header">
                <span>Card 2</span>
                <div>
                    <button class="minimize">-</button>
                    <button class="close">×</button>
                </div>
            </div>
            <div class="card-content">
                Medium card content.
            </div>
        </div>

        <div class="card" id="card3">
            <div class="card-header">
                <span>Card 3</span>
                <div>
                    <button class="minimize">-</button>
                    <button class="close">×</button>
                </div>
            </div>
            <div class="card-content">
                Another card content.
            </div>
        </div>

        <div class="card" id="card4">
            <div class="card-header">
                <span>Card 4</span>
                <div>
                    <button class="minimize">-</button>
                    <button class="close">×</button>
                </div>
            </div>
            <div class="card-content">
                Small card content.
            </div>
        </div>

        <div class="card" id="card5">
            <div class="card-header">
                <span>Card 5</span>
                <div>
                    <button class="minimize">-</button>
                    <button class="close">×</button>
                </div>
            </div>
            <div class="card-content">
                Large card content.
            </div>
        </div>

        <div class="card" id="card6">
            <div class="card-header">
                <span>Card 6</span>
                <div>
                    <button class="minimize">-</button>
                    <button class="close">×</button>
                </div>
            </div>
            <div class="card-content">
                Medium card content.
            </div>
        </div>
    </div>

    <script>
        let activeCard = null;
        let offsetX, offsetY;
        const maxIterations = 100;

        // Initialize card positions from CSS to inline styles
        function initializeCardPositions() {
            document.querySelectorAll('.card').forEach(card => {
                const computedStyle = window.getComputedStyle(card);
                card.style.left = computedStyle.left;
                card.style.top = computedStyle.top;
            });
        }

        function getCardRect(card) {
            const rect = card.getBoundingClientRect();
            return {
                left: rect.left,
                top: rect.top,
                width: rect.width,
                height: rect.height
            };
        }

        function isOverlapping(rect1, rect2) {
            return (
                rect1.left < rect2.left + rect2.width &&
                rect1.left + rect1.width > rect2.left &&
                rect1.top < rect2.top + rect2.height &&
                rect1.top + rect1.height > rect2.top
            );
        }

        function checkAndResolveCollisions(movedCard, iterations = 0) {
            if (iterations >= maxIterations) {
                console.warn('Max iterations reached in collision resolution');
                return;
            }

            let hasOverlaps = false;
            let dx = 0;
            let dy = 0;

            const movedRect = getCardRect(movedCard);
            const cards = Array.from(document.querySelectorAll('.card')).filter(card => card !== movedCard && card.style.display !== 'none');

            for (let otherCard of cards) {
                const otherRect = getCardRect(otherCard);
                if (isOverlapping(movedRect, otherRect)) {
                    hasOverlaps = true;
                    const cx1 = movedRect.left + movedRect.width / 2;
                    const cx2 = otherRect.left + otherRect.width / 2;
                    const cy1 = movedRect.top + movedRect.height / 2;
                    const cy2 = otherRect.top + otherRect.height / 2;
                    const angle = Math.atan2(cy2 - cy1, cx2 - cx1);
                    dx += -Math.cos(angle) * 5;
                    dy += -Math.sin(angle) * 5;
                }
            }

            if (hasOverlaps) {
                const newLeft = parseInt(movedCard.style.left || '0') + dx;
                const newTop = parseInt(movedCard.style.top || '0') + dy;
                const clampedLeft = Math.max(0, Math.min(newLeft, window.innerWidth - movedCard.offsetWidth));
                const clampedTop = Math.max(0, Math.min(newTop, window.innerHeight - movedCard.offsetHeight));
                movedCard.style.left = `${clampedLeft}px`;
                movedCard.style.top = `${clampedTop}px`;
                setTimeout(() => checkAndResolveCollisions(movedCard, iterations + 1), 50);
            }
        }

        // Initialize positions when page loads
        window.addEventListener('load', initializeCardPositions);

        document.querySelectorAll('.card').forEach(card => {
            const header = card.querySelector('.card-header');
            const closeBtn = card.querySelector('.close');
            const minimizeBtn = card.querySelector('.minimize');
            const content = card.querySelector('.card-content');

            header.addEventListener('mousedown', (e) => {
                activeCard = card;
                offsetX = e.clientX - parseInt(card.style.left || '0');
                offsetY = e.clientY - parseInt(card.style.top || '0');
                card.style.zIndex = 100;
            });

            closeBtn.addEventListener('click', () => {
                card.style.display = 'none';
                document.getElementById(`${card.id}-toggle`).checked = false;
            });

            minimizeBtn.addEventListener('click', () => {
                content.style.display = content.style.display === 'none' ? 'block' : 'none';
            });
        });

        document.addEventListener('mousemove', (e) => {
            if (!activeCard) return;

            let newX = e.clientX - offsetX;
            let newY = e.clientY - offsetY;

            newX = Math.max(0, Math.min(newX, window.innerWidth - activeCard.offsetWidth));
            newY = Math.max(0, Math.min(newY, window.innerHeight - activeCard.offsetHeight));

            activeCard.style.left = `${newX}px`;
            activeCard.style.top = `${newY}px`;
        });

        document.addEventListener('mouseup', () => {
            if (activeCard) {
                checkAndResolveCollisions(activeCard);
                activeCard.style.zIndex = 1;
                activeCard = null;
            }
        });

        document.querySelector('.settings-menu').addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                const cardId = e.target.id.replace('-toggle', '');
                const card = document.getElementById(cardId);
                card.style.display = e.target.checked ? 'block' : 'none';
                if (e.target.checked) {
                    checkAndResolveCollisions(card);
                }
            }
        });
    </script>
</body>
</html>